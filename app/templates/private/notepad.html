{% extends "base.html" %}
{% block title %}Notepad - Mediahub{% endblock %}

{% block navbar %}
    {% include 'navbar.html' %}
{% endblock %}

{% block sidebar %}
    {% include 'sidebar.html' %}
{% endblock %}

{% block content %}
<div class="container-fluid py-3 py-md-4">
    <div class="row justify-content-center">
        <div class="col-12 col-xl-10 col-xxl-9">
            <!-- Page Header -->
            <!-- <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
                <div>
                    <h4 class="mb-1 fw-bold">
                        <i class="fas fa-sticky-note text-warning me-2"></i>Notepad
                    </h4>
                    <p class="text-muted mb-0 small">Create and manage your personal notes</p>
                </div>
            </div> -->

            <!-- Main Notepad Card -->
            <div class="card shadow-sm border-0">
                <!-- Notepad Header -->
                <div class="card-header bg-transparent border-bottom">
                    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-3">
                        <!-- Left: Note Selector -->
                        <div class="d-flex align-items-center gap-2 w-50 w-sm-auto">
                            <i class="fas fa-file-alt text-primary d-none d-sm-block"></i>
                            <select id="noteSelect" class="form-select form-select-sm note-select">
                                <option value="" disabled selected>Select a note</option>
                            </select>
                        </div>
                        <!-- Right: Action Buttons -->
                        <div class="d-flex gap-2 flex-wrap">
                            <button id="newBtn" class="btn btn-outline-primary btn-sm" title="New Note">
                                <i class="fas fa-file-circle-plus"></i>
                                <span class="d-none d-sm-inline ms-1">New</span>
                            </button>
                            <button id="renameBtn" class="btn btn-outline-secondary btn-sm" title="Rename Note">
                                <i class="fas fa-pen-to-square"></i>
                                <span class="d-none d-sm-inline ms-1">Rename</span>
                            </button>
                            <button id="saveBtn" class="btn btn-outline-success btn-sm" title="Save Note">
                                <i class="fas fa-save"></i>
                                <span class="d-none d-sm-inline ms-1">Save</span>
                            </button>
                            <button id="deleteBtn" class="btn btn-outline-danger btn-sm" title="Delete Note">
                                <i class="fas fa-trash"></i>
                                <span class="d-none d-sm-inline ms-1">Delete</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Notepad Body -->
                <div class="card-body p-0">
                    <textarea 
                        id="noteInput" 
                        class="form-control note-textarea" 
                        placeholder="Start writing your notes here..."
                        spellcheck="true"
                    ></textarea>
                </div>

                <!-- Notepad Footer -->
                <div class="card-footer bg-transparent border-top">
                    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2">
                        <div id="statusMessage" class="small text-muted"></div>
                        <div class="d-flex align-items-center gap-3 text-muted small">
                            <span id="charCount">
                                <i class="fas fa-font me-1"></i>
                                <span class="char-count-value">0</span> characters
                            </span>
                            <span id="wordCount" class="d-none d-sm-inline">
                                <i class="fas fa-align-left me-1"></i>
                                <span class="word-count-value">0</span> words
                            </span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <!-- Add/Edit Modal -->
    <div class="modal fade" id="noteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">New Note</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="noteForm">
                        <input type="hidden" id="fileId">
                        <div class="mb-3">
                            <label for="noteName" class="form-label">Note Name</label>
                            <input type="text" class="form-control" id="noteName" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveModalBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this Note?</p>
                    <p class="text-muted mb-0">This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

</div>

<style>
/* Notepad Page Specific Styles */
.note-textarea {
    height: calc(100vh - 250px);
    min-height: 300px;
    max-height: 750px;
    resize: none;
    border: none;
    border-radius: 0;
    padding: 20px;
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
    font-size: 1rem;
    line-height: 1.8;
    background-color: var(--card-bg);
    color: var(--text-color);
}

.note-textarea:focus {
    box-shadow: none;
    outline: none;
    background-color: var(--card-bg);
    color: var(--text-color);
}

.note-textarea::placeholder {
    color: var(--text-color);
    opacity: 0.5;
}

.note-select {
    min-width: 200px;
    border-radius: 8px;
}

/* Card Styling */
.card {
    border-radius: 16px;
    overflow: hidden;
}

.card-header, .card-footer {
    padding: 16px 20px;
}

/* Keyboard shortcuts styling */
kbd {
    background-color: var(--table-stripe-bg);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 0.75rem;
    font-family: inherit;
}

/* Mobile Responsive Adjustments */
@media (max-width: 576px) {
    .note-textarea {
        height: calc(100vh - 340px);
        min-height: 250px;
        padding: 16px;
        font-size: 0.95rem;
    }
    
    .note-select {
        min-width: 100%;
    }
    
    .card-header {
        padding: 12px;
    }
    
    .card-footer {
        padding: 12px;
    }
}

@media (min-width: 577px) and (max-width: 991px) {
    .note-textarea {
        height: calc(100vh - 360px);
    }
}

/* Character/Word count styling */
#charCount, #wordCount {
    font-variant-numeric: tabular-nums;
}

/* Button transitions */
.btn {
    transition: all 0.2s ease;
}

.btn:active {
    transform: scale(0.95);
}
</style>
{% endblock %}

{% block script %}
    <script src="/assets/js/notepad.js" type="module"></script>
    <script>
        // Character and word count
        const noteInput = document.getElementById('noteInput');
        const charCountEl = document.querySelector('.char-count-value');
        const wordCountEl = document.querySelector('.word-count-value');
        
        function updateCounts() {
            const text = noteInput.value;
            charCountEl.textContent = text.length;
            
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            wordCountEl.textContent = words;
        }
        
        noteInput.addEventListener('input', updateCounts);
        
        // Initialize counts on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for note to load, then update counts
            const observer = new MutationObserver(function() {
                updateCounts();
            });
            
            noteInput.addEventListener('change', updateCounts);
            
            // Keyboard shortcut for save (Ctrl+S)
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    document.getElementById('saveBtn').click();
                }
            });
        });
    </script>
{% endblock %}
